<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Community Fork</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="hate.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            color: #ececec;
            height: 100vh;
            overflow: hidden;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #1a1a1a;
        }

        .sidebar-top {
            padding: 12px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 10px 12px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            color: #ececec;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            transition: border-color 0.15s;
            margin-bottom: 8px;
        }

        .social-btn:last-child {
            margin-bottom: 0;
        }

        .social-btn:hover {
            border-color: #6b6b6b;
        }

        .refresh-text {
            padding: 8px 12px;
            color: #6b6b6b;
            font-size: 12px;
            text-align: center;
        }

        .sidebar-spacer {
            flex: 1;
        }

        .sidebar-bottom {
            padding: 12px;
            border-top: 1px solid #1a1a1a;
        }

        .connect-wallet-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            background: #111111;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            cursor: pointer;
            color: #ececec;
            font-size: 14px;
            font-weight: 400;
            transition: border-color 0.15s;
        }

        .connect-wallet-btn:hover {
            border-color: #6b6b6b;
        }

        .wallet-connected {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 10px 12px;
            background: transparent;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            cursor: pointer;
            color: #ececec;
            text-align: left;
        }

        .wallet-avatar {
            width: 32px;
            height: 32px;
            background: #111111;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #da7756;
        }

        .wallet-info {
            display: flex;
            flex-direction: column;
        }

        .wallet-address {
            font-size: 14px;
        }

        .wallet-status {
            font-size: 12px;
            color: #6b6b6b;
        }

        /* Main */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000000;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }

        .model-select {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: #ececec;
            font-size: 14px;
            cursor: pointer;
        }

        .model-select:hover {
            background: #111111;
        }

        .header-btn {
            padding: 8px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #9a9a9a;
        }

        .header-btn:hover {
            background: #111111;
            color: #ececec;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 40px 20px;
            overflow-y: auto;
        }

        .messages {
            max-width: 768px;
            margin: 0 auto;
            width: 100%;
        }

        .message {
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        .message-avatar.user {
            background: #111111;
            border: 1px solid #1a1a1a;
        }

        .message-avatar.assistant {
            background: #da7756;
        }

        .message-content {
            flex: 1;
        }

        .message-author {
            font-size: 13px;
            font-weight: 500;
            color: #9a9a9a;
            margin-bottom: 6px;
        }

        .message-text {
            font-size: 15px;
            line-height: 1.6;
            color: #ececec;
            white-space: pre-wrap;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dots span {
            color: #9a9a9a;
            animation: pulse 1.5s infinite;
        }

        .loading-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Input Area */
        .input-section {
            padding: 16px 20px 24px;
        }

        .input-container {
            max-width: 768px;
            margin: 0 auto;
        }

        .input-box {
            background: #111111;
            border-radius: 20px;
            padding: 4px;
        }

        .input-inner {
            display: flex;
            align-items: flex-end;
        }

        .text-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 16px;
            font-size: 15px;
            color: #ececec;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
            min-height: 24px;
            max-height: 200px;
        }

        .text-input::placeholder {
            color: #6b6b6b;
        }

        .input-buttons {
            display: flex;
            align-items: center;
            padding: 8px;
            gap: 2px;
        }

        .input-btn {
            padding: 8px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #6b6b6b;
        }

        .input-btn:hover {
            background: #1a1a1a;
            color: #9a9a9a;
        }

        .send-btn {
            padding: 8px;
            background: #6b6b6b;
            border: none;
            border-radius: 8px;
            cursor: not-allowed;
            color: #000000;
            transition: background 0.15s;
        }

        .send-btn.active {
            background: #da7756;
            cursor: pointer;
        }

        .send-btn:disabled {
            opacity: 0.5;
        }

        .input-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-top: 12px;
            font-size: 12px;
            color: #6b6b6b;
        }

        .input-footer span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #000000;
            border-radius: 16px;
            padding: 24px;
            width: 360px;
            border: 1px solid #1a1a1a;
        }

        .modal h2 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            text-align: center;
        }

        .wallet-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 14px 16px;
            background: #111111;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            cursor: pointer;
            color: #ececec;
            font-size: 15px;
            text-align: left;
            transition: border-color 0.15s;
        }

        .wallet-option:hover {
            border-color: #6b6b6b;
        }

        .wallet-option span:first-child {
            font-size: 24px;
        }

        .modal-footer {
            font-size: 12px;
            color: #6b6b6b;
            text-align: center;
            margin-top: 16px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-top">
                <a href="https://x.com/CommunityForks" target="_blank" rel="noopener noreferrer" class="social-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#ececec">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
                <a href="https://github.com/CommunityFork/communityfork" target="_blank" rel="noopener noreferrer" class="social-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#ececec">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
            </div>

            <div class="refresh-text">Refresh to start new chat</div>

            <div class="sidebar-spacer"></div>

            <div class="sidebar-bottom">
                <button id="connectWalletBtn" class="connect-wallet-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="4" width="20" height="16" rx="2"/>
                        <path d="M16 12h.01"/>
                    </svg>
                    Connect Wallet
                </button>
                <button id="walletConnected" class="wallet-connected hidden">
                    <div class="wallet-avatar">‚óé</div>
                    <div class="wallet-info">
                        <div class="wallet-address" id="walletAddressDisplay"></div>
                        <div class="wallet-status">Connected</div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Main -->
        <div class="main">
            <div class="header">
                <button class="model-select">
                    <span>Fork 4</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9a9a9a" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <button class="header-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                </button>
            </div>

            <div class="chat-area">
                <div class="messages" id="messages"></div>
            </div>

            <div class="input-section">
                <div class="input-container">
                    <div class="input-box">
                        <div class="input-inner">
                            <textarea id="messageInput" class="text-input" placeholder="What do you want to build?" rows="1"></textarea>
                            <div class="input-buttons">
                                <button class="input-btn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                                    </svg>
                                </button>
                                <button id="sendBtn" class="send-btn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="input-footer">
                        <span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            Community powered
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wallet Modal -->
    <div id="walletModal" class="modal-overlay">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Connect a wallet</h2>
            <div class="wallet-list">
                <button class="wallet-option" data-wallet="phantom">
                    <span>üëª</span>
                    <span>Phantom</span>
                </button>
                <button class="wallet-option" data-wallet="solflare">
                    <span>üîÜ</span>
                    <span>Solflare</span>
                </button>
                <button class="wallet-option" data-wallet="backpack">
                    <span>üéí</span>
                    <span>Backpack</span>
                </button>
                <button class="wallet-option" data-wallet="glow">
                    <span>‚ú®</span>
                    <span>Glow</span>
                </button>
            </div>
            <p class="modal-footer">By connecting, you agree to the Terms of Service</p>
        </div>
    </div>

    <script>
        // State
        let walletAddress = null;
        let conversationStage = 0;
        let isLoading = false;
        let messages = [];

        // AI prompts
        const aiPrompts = [
            "What would you like to add to the community fork?",
            "Interesting idea! Can you tell me more about how this feature should work?",
            "Got it! What should we name this feature in the codebase?",
            "Perfect! Any specific parameters or configurations you want for this?",
            "Awesome! One last thing - any additional notes or comments for the GitHub commit?"
        ];

        // DOM Elements
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const walletConnected = document.getElementById('walletConnected');
        const walletAddressDisplay = document.getElementById('walletAddressDisplay');
        const walletModal = document.getElementById('walletModal');
        const walletOptions = document.querySelectorAll('.wallet-option');

        // Initialize
        function init() {
            addMessage('assistant', aiPrompts[0]);
            
            messageInput.addEventListener('input', handleInput);
            messageInput.addEventListener('keydown', handleKeyDown);
            sendBtn.addEventListener('click', sendMessage);
            connectWalletBtn.addEventListener('click', () => walletModal.classList.add('active'));
            walletModal.addEventListener('click', () => walletModal.classList.remove('active'));
            walletConnected.addEventListener('click', disconnectWallet);
            
            walletOptions.forEach(option => {
                option.addEventListener('click', () => connectWallet(option.dataset.wallet));
            });
        }

        function handleInput() {
            // Auto-resize textarea
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
            
            // Update send button
            if (messageInput.value.trim()) {
                sendBtn.classList.add('active');
            } else {
                sendBtn.classList.remove('active');
            }
        }

        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function addMessage(role, content) {
            messages.push({ role, content });
            renderMessages();
        }

        function renderMessages() {
            messagesContainer.innerHTML = messages.map(msg => `
                <div class="message">
                    <div class="message-avatar ${msg.role}">
                        ${msg.role === 'user' ? '‚óé' : '‚ú¶'}
                    </div>
                    <div class="message-content">
                        <div class="message-author">
                            ${msg.role === 'user' ? (walletAddress ? truncateAddress(walletAddress) : 'You') : 'Community Fork AI'}
                        </div>
                        <div class="message-text">${msg.content}</div>
                    </div>
                </div>
            `).join('');
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showLoading() {
            const loadingHtml = `
                <div class="message" id="loadingMessage">
                    <div class="message-avatar assistant">‚ú¶</div>
                    <div class="message-content">
                        <div class="message-author">Community Fork AI</div>
                        <div class="loading-dots">
                            <span>‚óè</span>
                            <span>‚óè</span>
                            <span>‚óè</span>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.insertAdjacentHTML('beforeend', loadingHtml);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideLoading() {
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) loadingMessage.remove();
        }

        async function sendMessage() {
            if (!messageInput.value.trim() || isLoading) return;

            const userMessage = messageInput.value.trim();
            addMessage('user', userMessage);
            messageInput.value = '';
            handleInput();
            
            isLoading = true;
            showLoading();

            // Simulate AI thinking
            await new Promise(resolve => setTimeout(resolve, 1000));

            if (conversationStage < aiPrompts.length - 1) {
                hideLoading();
                conversationStage++;
                addMessage('assistant', aiPrompts[conversationStage]);
                isLoading = false;
            } else {
                hideLoading();
                addMessage('assistant', '‚è≥ Uploading to GitHub...');
                
                // Wait 30 seconds
                await new Promise(resolve => setTimeout(resolve, 30000));
                
                // Remove the uploading message and show success
                messages.pop();
                addMessage('assistant', '‚úÖ Change added!\n\nüîó https://github.com/CommunityFork/communityfork\n\nYour feature has been added to The Community Fork! The community can now review and vote on it.');
                isLoading = false;
            }
        }

        function truncateAddress(address) {
            return `${address.slice(0, 4)}...${address.slice(-4)}`;
        }

        async function connectWallet(walletId) {
            try {
                let provider;
                
                if (walletId === 'phantom') {
                    provider = window?.solana;
                    if (!provider?.isPhantom) {
                        window.open('https://phantom.app/', '_blank');
                        return;
                    }
                } else if (walletId === 'solflare') {
                    provider = window?.solflare;
                    if (!provider?.isSolflare) {
                        window.open('https://solflare.com/', '_blank');
                        return;
                    }
                } else if (walletId === 'backpack') {
                    provider = window?.backpack;
                    if (!provider) {
                        window.open('https://backpack.app/', '_blank');
                        return;
                    }
                } else if (walletId === 'glow') {
                    provider = window?.glow;
                    if (!provider) {
                        window.open('https://glow.app/', '_blank');
                        return;
                    }
                }

                const response = await provider.connect();
                walletAddress = response.publicKey.toString();
                
                walletAddressDisplay.textContent = truncateAddress(walletAddress);
                connectWalletBtn.classList.add('hidden');
                walletConnected.classList.remove('hidden');
                walletModal.classList.remove('active');
                
                renderMessages(); // Re-render to show wallet address
            } catch (err) {
                console.error('Wallet connection failed:', err);
            }
        }

        async function disconnectWallet() {
            try {
                if (window?.solana) {
                    await window.solana.disconnect();
                }
                walletAddress = null;
                connectWalletBtn.classList.remove('hidden');
                walletConnected.classList.add('hidden');
                renderMessages();
            } catch (err) {
                console.error('Disconnect failed:', err);
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>
